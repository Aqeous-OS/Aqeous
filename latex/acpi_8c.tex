\hypertarget{acpi_8c}{}\section{Experimental Edition/\+Source/\+Drivers/\+A\+C\+P\+I/acpi.c File Reference}
\label{acpi_8c}\index{Experimental Edition/\+Source/\+Drivers/\+A\+C\+P\+I/acpi.\+c@{Experimental Edition/\+Source/\+Drivers/\+A\+C\+P\+I/acpi.\+c}}
{\ttfamily \#include $<$stddef.\+h$>$}\\*
{\ttfamily \#include $<$console.\+h$>$}\\*
{\ttfamily \#include $<$string.\+h$>$}\\*
{\ttfamily \#include $<$sys.\+h$>$}\\*
{\ttfamily \#include $<$system.\+h$>$}\\*
Include dependency graph for acpi.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{acpi_8c__incl}
\end{center}
\end{figure}
This graph shows which files directly or indirectly include this file\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=192pt]{acpi_8c__dep__incl}
\end{center}
\end{figure}
\subsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structRSDPtr}{R\+S\+D\+Ptr}
\item 
struct \hyperlink{structFACP}{F\+A\+CP}
\end{DoxyCompactItemize}
\subsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
typedef unsigned char \hyperlink{acpi_8c_a0c8186d9b9b7880309c27230bbb5e69d}{byte}
\item 
typedef unsigned short \hyperlink{acpi_8c_a285e72252c100e2508e4e933a0738f2b}{word}
\item 
typedef unsigned long \hyperlink{acpi_8c_a74cb93d430006e784da73b8ca406ee6e}{dword}
\item 
typedef unsigned int \hyperlink{acpi_8c_a97e9b18a159dda578a4e92c8c5634633}{qword}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
unsigned int $\ast$ \hyperlink{acpi_8c_ac6e4f33d3233a13cacc16cb3b4a1b00d}{acpi\+Check\+R\+S\+D\+Ptr} (unsigned int $\ast$ptr)
\item 
unsigned int $\ast$ \hyperlink{acpi_8c_a6ea46d1e05611b3b6a689777fe4a23c3}{acpi\+Get\+R\+S\+D\+Ptr} (void)
\item 
int \hyperlink{acpi_8c_ae00c7f44d9e3e3bedcc4b43425788c43}{acpi\+Check\+Header} (unsigned int $\ast$ptr, char $\ast$sig)
\item 
int \hyperlink{acpi_8c_a7785e47ec7c5a61c43890af2581da359}{acpi\+Enable} (void)
\item 
int \hyperlink{acpi_8c_a7fe73cf42200ac2245d5dd48fe2268db}{init\+Acpi} (void)
\item 
void \hyperlink{acpi_8c_a6f63c2b70d3c6d268bdc2423d3fdfb9f}{acpi\+Power\+Off} (void)
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hyperlink{acpi_8c_a74cb93d430006e784da73b8ca406ee6e}{dword} $\ast$ \hyperlink{acpi_8c_a33b8ab25b3f4c51863b154877144f3df}{S\+M\+I\+\_\+\+C\+MD}
\item 
\hyperlink{acpi_8c_a0c8186d9b9b7880309c27230bbb5e69d}{byte} \hyperlink{acpi_8c_a34153f28c481147d24e470eb95db14ea}{A\+C\+P\+I\+\_\+\+E\+N\+A\+B\+LE}
\item 
\hyperlink{acpi_8c_a0c8186d9b9b7880309c27230bbb5e69d}{byte} \hyperlink{acpi_8c_a03d9362da0e66c33d75b9a3249255158}{A\+C\+P\+I\+\_\+\+D\+I\+S\+A\+B\+LE}
\item 
\hyperlink{acpi_8c_a74cb93d430006e784da73b8ca406ee6e}{dword} $\ast$ \hyperlink{acpi_8c_a1a546c2755013ff60aaafcdab0befae9}{P\+M1a\+\_\+\+C\+NT}
\item 
\hyperlink{acpi_8c_a74cb93d430006e784da73b8ca406ee6e}{dword} $\ast$ \hyperlink{acpi_8c_a58d7d7d0ab171e520fae96b370db740b}{P\+M1b\+\_\+\+C\+NT}
\item 
\hyperlink{acpi_8c_a285e72252c100e2508e4e933a0738f2b}{word} \hyperlink{acpi_8c_a377b954bbafc1caae62c790a84625e2c}{S\+L\+P\+\_\+\+T\+Y\+Pa}
\item 
\hyperlink{acpi_8c_a285e72252c100e2508e4e933a0738f2b}{word} \hyperlink{acpi_8c_a73d59c76364473fa8dfb23f609728568}{S\+L\+P\+\_\+\+T\+Y\+Pb}
\item 
\hyperlink{acpi_8c_a285e72252c100e2508e4e933a0738f2b}{word} \hyperlink{acpi_8c_a865638a43175e3591eb2c085ffd21317}{S\+L\+P\+\_\+\+EN}
\item 
\hyperlink{acpi_8c_a285e72252c100e2508e4e933a0738f2b}{word} \hyperlink{acpi_8c_a15c1e5908be89bca113b617faa86b6f3}{S\+C\+I\+\_\+\+EN}
\item 
\hyperlink{acpi_8c_a0c8186d9b9b7880309c27230bbb5e69d}{byte} \hyperlink{acpi_8c_a1a17515f9c86fc1266c1f04b7c5eb10e}{P\+M1\+\_\+\+C\+N\+T\+\_\+\+L\+EN}
\end{DoxyCompactItemize}


\subsection{Typedef Documentation}
\index{acpi.\+c@{acpi.\+c}!byte@{byte}}
\index{byte@{byte}!acpi.\+c@{acpi.\+c}}
\subsubsection[{\texorpdfstring{byte}{byte}}]{\setlength{\rightskip}{0pt plus 5cm}typedef unsigned char {\bf byte}}\hypertarget{acpi_8c_a0c8186d9b9b7880309c27230bbb5e69d}{}\label{acpi_8c_a0c8186d9b9b7880309c27230bbb5e69d}


Definition at line 7 of file acpi.\+c.

\index{acpi.\+c@{acpi.\+c}!dword@{dword}}
\index{dword@{dword}!acpi.\+c@{acpi.\+c}}
\subsubsection[{\texorpdfstring{dword}{dword}}]{\setlength{\rightskip}{0pt plus 5cm}typedef unsigned long {\bf dword}}\hypertarget{acpi_8c_a74cb93d430006e784da73b8ca406ee6e}{}\label{acpi_8c_a74cb93d430006e784da73b8ca406ee6e}


Definition at line 9 of file acpi.\+c.

\index{acpi.\+c@{acpi.\+c}!qword@{qword}}
\index{qword@{qword}!acpi.\+c@{acpi.\+c}}
\subsubsection[{\texorpdfstring{qword}{qword}}]{\setlength{\rightskip}{0pt plus 5cm}typedef unsigned int {\bf qword}}\hypertarget{acpi_8c_a97e9b18a159dda578a4e92c8c5634633}{}\label{acpi_8c_a97e9b18a159dda578a4e92c8c5634633}


Definition at line 10 of file acpi.\+c.

\index{acpi.\+c@{acpi.\+c}!word@{word}}
\index{word@{word}!acpi.\+c@{acpi.\+c}}
\subsubsection[{\texorpdfstring{word}{word}}]{\setlength{\rightskip}{0pt plus 5cm}typedef unsigned short {\bf word}}\hypertarget{acpi_8c_a285e72252c100e2508e4e933a0738f2b}{}\label{acpi_8c_a285e72252c100e2508e4e933a0738f2b}


Definition at line 8 of file acpi.\+c.



\subsection{Function Documentation}
\index{acpi.\+c@{acpi.\+c}!acpi\+Check\+Header@{acpi\+Check\+Header}}
\index{acpi\+Check\+Header@{acpi\+Check\+Header}!acpi.\+c@{acpi.\+c}}
\subsubsection[{\texorpdfstring{acpi\+Check\+Header(unsigned int $\ast$ptr, char $\ast$sig)}{acpiCheckHeader(unsigned int *ptr, char *sig)}}]{\setlength{\rightskip}{0pt plus 5cm}int acpi\+Check\+Header (
\begin{DoxyParamCaption}
\item[{unsigned int $\ast$}]{ptr, }
\item[{char $\ast$}]{sig}
\end{DoxyParamCaption}
)}\hypertarget{acpi_8c_ae00c7f44d9e3e3bedcc4b43425788c43}{}\label{acpi_8c_ae00c7f44d9e3e3bedcc4b43425788c43}


Definition at line 124 of file acpi.\+c.


\begin{DoxyCode}
125 \{
126    \textcolor{keywordflow}{if} (\hyperlink{string_8h_a3376078c105a2293e911a180e7fbab4b}{memcmp}(ptr, sig, 4) == 0)
127    \{
128       \textcolor{keywordtype}{char} *checkPtr = (\textcolor{keywordtype}{char} *) ptr;
129       \textcolor{keywordtype}{int} len = *(ptr + 1);
130       \textcolor{keywordtype}{char} check = 0;
131       \textcolor{keywordflow}{while} (0<len--)
132       \{
133          check += *checkPtr;
134          checkPtr++;
135       \}
136       \textcolor{keywordflow}{if} (check == 0)
137          \textcolor{keywordflow}{return} 0;
138    \}
139    \textcolor{keywordflow}{return} -1;
140 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=268pt]{acpi_8c_ae00c7f44d9e3e3bedcc4b43425788c43_cgraph}
\end{center}
\end{figure}


\index{acpi.\+c@{acpi.\+c}!acpi\+Check\+R\+S\+D\+Ptr@{acpi\+Check\+R\+S\+D\+Ptr}}
\index{acpi\+Check\+R\+S\+D\+Ptr@{acpi\+Check\+R\+S\+D\+Ptr}!acpi.\+c@{acpi.\+c}}
\subsubsection[{\texorpdfstring{acpi\+Check\+R\+S\+D\+Ptr(unsigned int $\ast$ptr)}{acpiCheckRSDPtr(unsigned int *ptr)}}]{\setlength{\rightskip}{0pt plus 5cm}unsigned int$\ast$ acpi\+Check\+R\+S\+D\+Ptr (
\begin{DoxyParamCaption}
\item[{unsigned int $\ast$}]{ptr}
\end{DoxyParamCaption}
)}\hypertarget{acpi_8c_ac6e4f33d3233a13cacc16cb3b4a1b00d}{}\label{acpi_8c_ac6e4f33d3233a13cacc16cb3b4a1b00d}


Definition at line 56 of file acpi.\+c.


\begin{DoxyCode}
57 \{
58    \textcolor{keywordtype}{char} *sig = \textcolor{stringliteral}{"RSD PTR "};
59    \textcolor{keyword}{struct }\hyperlink{structRSDPtr}{RSDPtr} *rsdp = (\textcolor{keyword}{struct }\hyperlink{structRSDPtr}{RSDPtr} *) ptr;
60    \hyperlink{acpi_8c_a0c8186d9b9b7880309c27230bbb5e69d}{byte} *bptr;
61    \hyperlink{acpi_8c_a0c8186d9b9b7880309c27230bbb5e69d}{byte} check = 0;
62    uint32\_t i;
63 
64    \textcolor{keywordflow}{if} (\hyperlink{string_8h_a3376078c105a2293e911a180e7fbab4b}{memcmp}(sig, rsdp, 8) == 0)
65    \{
66       \textcolor{comment}{// check checksum rsdpd}
67       bptr = (\hyperlink{acpi_8c_a0c8186d9b9b7880309c27230bbb5e69d}{byte} *) ptr;
68       \textcolor{keywordflow}{for} (i=0; i<\textcolor{keyword}{sizeof}(\textcolor{keyword}{struct }\hyperlink{structRSDPtr}{RSDPtr}); i++)
69       \{
70          check += *bptr;
71          bptr++;
72       \}
73 
74       \textcolor{comment}{// found valid rsdpd}
75       \textcolor{keywordflow}{if} (check == 0) \{
76          \textcolor{comment}{/*}
77 \textcolor{comment}{          if (desc->Revision == 0)}
78 \textcolor{comment}{            wrstr("acpi 1");}
79 \textcolor{comment}{         else}
80 \textcolor{comment}{            wrstr("acpi 2");}
81 \textcolor{comment}{         */}
82          \textcolor{keywordflow}{return} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} *) rsdp->\hyperlink{structRSDPtr_a982825bea34910320148af4114ba8e00}{RsdtAddress};
83       \}
84    \}
85 
86    \textcolor{keywordflow}{return} \hyperlink{common_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
87 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=271pt]{acpi_8c_ac6e4f33d3233a13cacc16cb3b4a1b00d_cgraph}
\end{center}
\end{figure}


\index{acpi.\+c@{acpi.\+c}!acpi\+Enable@{acpi\+Enable}}
\index{acpi\+Enable@{acpi\+Enable}!acpi.\+c@{acpi.\+c}}
\subsubsection[{\texorpdfstring{acpi\+Enable(void)}{acpiEnable(void)}}]{\setlength{\rightskip}{0pt plus 5cm}int acpi\+Enable (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}\hypertarget{acpi_8c_a7785e47ec7c5a61c43890af2581da359}{}\label{acpi_8c_a7785e47ec7c5a61c43890af2581da359}


Definition at line 144 of file acpi.\+c.


\begin{DoxyCode}
145 \{
146    \textcolor{comment}{// check if acpi is enabled}
147    \textcolor{keywordflow}{if} ( (\hyperlink{sys_8h_a3dcbb9e13203beb0e38956999e8ae61d}{inw}((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}) \hyperlink{acpi_8c_a1a546c2755013ff60aaafcdab0befae9}{PM1a\_CNT}) &\hyperlink{acpi_8c_a15c1e5908be89bca113b617faa86b6f3}{SCI\_EN}) == 0 )
148    \{
149       \textcolor{comment}{// check if acpi can be enabled}
150       \textcolor{keywordflow}{if} (\hyperlink{acpi_8c_a33b8ab25b3f4c51863b154877144f3df}{SMI\_CMD} != 0 && \hyperlink{acpi_8c_a34153f28c481147d24e470eb95db14ea}{ACPI\_ENABLE} != 0)
151       \{
152          \hyperlink{sys_8h_a1fe613f83e149aa1a4ae0d5f5149ab34}{outb}((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}) \hyperlink{acpi_8c_a33b8ab25b3f4c51863b154877144f3df}{SMI\_CMD}, \hyperlink{acpi_8c_a34153f28c481147d24e470eb95db14ea}{ACPI\_ENABLE}); \textcolor{comment}{// send acpi enable command}
153          \textcolor{comment}{// give 3 seconds time to enable acpi}
154          \textcolor{keywordtype}{int} i;
155          \textcolor{keywordflow}{for} (i=0; i<300; i++ )
156          \{
157             \textcolor{keywordflow}{if} ( (\hyperlink{sys_8h_a3dcbb9e13203beb0e38956999e8ae61d}{inw}((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}) PM1a\_CNT) &SCI\_EN) == 1 )
158                \textcolor{keywordflow}{break};
159             \hyperlink{ata_8c_ab24cd262423caf1599380572e83824fa}{sleep}(10);
160          \}
161          \textcolor{keywordflow}{if} (\hyperlink{acpi_8c_a58d7d7d0ab171e520fae96b370db740b}{PM1b\_CNT} != 0)
162             \textcolor{keywordflow}{for} (; i<300; i++ )
163             \{
164                \textcolor{keywordflow}{if} ( (\hyperlink{sys_8h_a3dcbb9e13203beb0e38956999e8ae61d}{inw}((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}) \hyperlink{acpi_8c_a58d7d7d0ab171e520fae96b370db740b}{PM1b\_CNT}) &SCI\_EN) == 1 )
165                   \textcolor{keywordflow}{break};
166                \hyperlink{ata_8c_ab24cd262423caf1599380572e83824fa}{sleep}(10);
167             \}
168          \textcolor{keywordflow}{if} (i<300) \{
169             \hyperlink{console_8c_a7e3f5006dd96b9d8c61242ddc5351832}{console\_writestring}(\textcolor{stringliteral}{"enabled acpi.\(\backslash\)n"});
170             \textcolor{keywordflow}{return} 0;
171          \} \textcolor{keywordflow}{else} \{
172             \hyperlink{console_8c_a7e3f5006dd96b9d8c61242ddc5351832}{console\_writestring}(\textcolor{stringliteral}{"couldn't enable acpi.\(\backslash\)n"});
173             \textcolor{keywordflow}{return} -1;
174          \}
175       \} \textcolor{keywordflow}{else} \{
176          \hyperlink{console_8c_a7e3f5006dd96b9d8c61242ddc5351832}{console\_writestring}(\textcolor{stringliteral}{"no known way to enable acpi.\(\backslash\)n"});
177          \textcolor{keywordflow}{return} -1;
178       \}
179    \} \textcolor{keywordflow}{else} \{
180       \textcolor{comment}{//wrstr("acpi was already enabled.\(\backslash\)n");}
181       \textcolor{keywordflow}{return} 0;
182    \}
183 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{acpi_8c_a7785e47ec7c5a61c43890af2581da359_cgraph}
\end{center}
\end{figure}


\index{acpi.\+c@{acpi.\+c}!acpi\+Get\+R\+S\+D\+Ptr@{acpi\+Get\+R\+S\+D\+Ptr}}
\index{acpi\+Get\+R\+S\+D\+Ptr@{acpi\+Get\+R\+S\+D\+Ptr}!acpi.\+c@{acpi.\+c}}
\subsubsection[{\texorpdfstring{acpi\+Get\+R\+S\+D\+Ptr(void)}{acpiGetRSDPtr(void)}}]{\setlength{\rightskip}{0pt plus 5cm}unsigned int$\ast$ acpi\+Get\+R\+S\+D\+Ptr (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}\hypertarget{acpi_8c_a6ea46d1e05611b3b6a689777fe4a23c3}{}\label{acpi_8c_a6ea46d1e05611b3b6a689777fe4a23c3}


Definition at line 92 of file acpi.\+c.


\begin{DoxyCode}
93 \{
94    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} *\hyperlink{multiboot_8h_a48f994dfe1a5aea3bce6dc7d2be8efd5}{addr};
95    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} *rsdp;
96 
97    \textcolor{comment}{// search below the 1mb mark for RSDP signature}
98    \textcolor{keywordflow}{for} (addr = (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} *) 0x000E0000; (int) addr<0x00100000; addr += 0x10/\textcolor{keyword}{sizeof}(
      \hyperlink{multiboot_8h_a48f994dfe1a5aea3bce6dc7d2be8efd5}{addr}))
99    \{
100       rsdp = \hyperlink{acpi_8c_ac6e4f33d3233a13cacc16cb3b4a1b00d}{acpiCheckRSDPtr}(addr);
101       \textcolor{keywordflow}{if} (rsdp != \hyperlink{common_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
102          \textcolor{keywordflow}{return} rsdp;
103    \}
104 
105 
106    \textcolor{comment}{// at address 0x40:0x0E is the RM segment of the ebda}
107    \textcolor{keywordtype}{int} ebda = *((\textcolor{keywordtype}{short} *) 0x40E);   \textcolor{comment}{// get pointer}
108    ebda = ebda*0x10 &0x000FFFFF;   \textcolor{comment}{// transform segment into linear address}
109 
110    \textcolor{comment}{// search Extended BIOS Data Area for the Root System Description Pointer signature}
111    \textcolor{keywordflow}{for} (addr = (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} *) ebda; (int) addr<ebda+1024; addr+= 0x10/\textcolor{keyword}{sizeof}(
      \hyperlink{multiboot_8h_a48f994dfe1a5aea3bce6dc7d2be8efd5}{addr}))
112    \{
113       rsdp = \hyperlink{acpi_8c_ac6e4f33d3233a13cacc16cb3b4a1b00d}{acpiCheckRSDPtr}(addr);
114       \textcolor{keywordflow}{if} (rsdp != \hyperlink{common_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
115          \textcolor{keywordflow}{return} rsdp;
116    \}
117 
118    \textcolor{keywordflow}{return} \hyperlink{common_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
119 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{acpi_8c_a6ea46d1e05611b3b6a689777fe4a23c3_cgraph}
\end{center}
\end{figure}


\index{acpi.\+c@{acpi.\+c}!acpi\+Power\+Off@{acpi\+Power\+Off}}
\index{acpi\+Power\+Off@{acpi\+Power\+Off}!acpi.\+c@{acpi.\+c}}
\subsubsection[{\texorpdfstring{acpi\+Power\+Off(void)}{acpiPowerOff(void)}}]{\setlength{\rightskip}{0pt plus 5cm}void acpi\+Power\+Off (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}\hypertarget{acpi_8c_a6f63c2b70d3c6d268bdc2423d3fdfb9f}{}\label{acpi_8c_a6f63c2b70d3c6d268bdc2423d3fdfb9f}


Definition at line 289 of file acpi.\+c.


\begin{DoxyCode}
290 \{
291    \textcolor{comment}{// SCI\_EN is set to 1 if acpi shutdown is possible}
292    \textcolor{keywordflow}{if} (\hyperlink{acpi_8c_a15c1e5908be89bca113b617faa86b6f3}{SCI\_EN} == 0)
293       \textcolor{keywordflow}{return};
294 
295    \hyperlink{acpi_8c_a7785e47ec7c5a61c43890af2581da359}{acpiEnable}();
296 
297    \textcolor{comment}{// send the shutdown command}
298    \hyperlink{sys_8h_aab8bf5abe19006ff9a80654d87f98908}{outw}((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}) \hyperlink{acpi_8c_a1a546c2755013ff60aaafcdab0befae9}{PM1a\_CNT}, \hyperlink{acpi_8c_a377b954bbafc1caae62c790a84625e2c}{SLP\_TYPa} | \hyperlink{acpi_8c_a865638a43175e3591eb2c085ffd21317}{SLP\_EN} );
299    \textcolor{keywordflow}{if} ( \hyperlink{acpi_8c_a58d7d7d0ab171e520fae96b370db740b}{PM1b\_CNT} != 0 )
300       \hyperlink{sys_8h_aab8bf5abe19006ff9a80654d87f98908}{outw}((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}) \hyperlink{acpi_8c_a58d7d7d0ab171e520fae96b370db740b}{PM1b\_CNT}, \hyperlink{acpi_8c_a73d59c76364473fa8dfb23f609728568}{SLP\_TYPb} | \hyperlink{acpi_8c_a865638a43175e3591eb2c085ffd21317}{SLP\_EN} );
301 
302    \hyperlink{console_8c_a7e3f5006dd96b9d8c61242ddc5351832}{console\_writestring}(\textcolor{stringliteral}{"acpi poweroff failed.\(\backslash\)n"});
303 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{acpi_8c_a6f63c2b70d3c6d268bdc2423d3fdfb9f_cgraph}
\end{center}
\end{figure}


\index{acpi.\+c@{acpi.\+c}!init\+Acpi@{init\+Acpi}}
\index{init\+Acpi@{init\+Acpi}!acpi.\+c@{acpi.\+c}}
\subsubsection[{\texorpdfstring{init\+Acpi(void)}{initAcpi(void)}}]{\setlength{\rightskip}{0pt plus 5cm}int init\+Acpi (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}\hypertarget{acpi_8c_a7fe73cf42200ac2245d5dd48fe2268db}{}\label{acpi_8c_a7fe73cf42200ac2245d5dd48fe2268db}


Definition at line 205 of file acpi.\+c.


\begin{DoxyCode}
206 \{
207    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} *ptr = \hyperlink{acpi_8c_a6ea46d1e05611b3b6a689777fe4a23c3}{acpiGetRSDPtr}();
208 
209    \textcolor{comment}{// check if address is correct  ( if acpi is available on this pc )}
210    \textcolor{keywordflow}{if} (ptr != \hyperlink{common_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} && \hyperlink{acpi_8c_ae00c7f44d9e3e3bedcc4b43425788c43}{acpiCheckHeader}(ptr, \textcolor{stringliteral}{"RSDT"}) == 0)
211    \{
212       \textcolor{comment}{// the RSDT contains an unknown number of pointers to acpi tables}
213       \textcolor{keywordtype}{int} entrys = *(ptr + 1);
214       entrys = (entrys-36) /4;
215       ptr += 36/4;   \textcolor{comment}{// skip header information}
216 
217       \textcolor{keywordflow}{while} (0<entrys--)
218       \{
219          \textcolor{comment}{// check if the desired table is reached}
220          \textcolor{keywordflow}{if} (\hyperlink{acpi_8c_ae00c7f44d9e3e3bedcc4b43425788c43}{acpiCheckHeader}((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} *) *ptr, \textcolor{stringliteral}{"FACP"}) == 0)
221          \{
222             entrys = -2;
223             \textcolor{keyword}{struct }\hyperlink{structFACP}{FACP} *facp = (\textcolor{keyword}{struct }\hyperlink{structFACP}{FACP} *) *ptr;
224             \textcolor{keywordflow}{if} (\hyperlink{acpi_8c_ae00c7f44d9e3e3bedcc4b43425788c43}{acpiCheckHeader}((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} *) facp->\hyperlink{structFACP_ae9d89be6ba26f7c9109d901c2daa3a75}{DSDT}, \textcolor{stringliteral}{"DSDT"}) == 0)
225             \{
226                \textcolor{comment}{// search the \(\backslash\)\_S5 package in the DSDT}
227                \textcolor{keywordtype}{char} *S5Addr = (\textcolor{keywordtype}{char} *) facp->\hyperlink{structFACP_ae9d89be6ba26f7c9109d901c2daa3a75}{DSDT} +36; \textcolor{comment}{// skip header}
228                \textcolor{keywordtype}{int} dsdtLength = *(facp->\hyperlink{structFACP_ae9d89be6ba26f7c9109d901c2daa3a75}{DSDT}+1) -36;
229                \textcolor{keywordflow}{while} (0 < dsdtLength--)
230                \{
231                   \textcolor{keywordflow}{if} ( \hyperlink{string_8h_a3376078c105a2293e911a180e7fbab4b}{memcmp}(S5Addr, \textcolor{stringliteral}{"\_S5\_"}, 4) == 0)
232                      \textcolor{keywordflow}{break};
233                   S5Addr++;
234                \}
235                \textcolor{comment}{// check if \(\backslash\)\_S5 was found}
236                \textcolor{keywordflow}{if} (dsdtLength > 0)
237                \{
238                   \textcolor{comment}{// check for valid AML structure}
239                   \textcolor{keywordflow}{if} ( ( *(S5Addr-1) == 0x08 || ( *(S5Addr-2) == 0x08 && *(S5Addr-1) == \textcolor{charliteral}{'\(\backslash\)\(\backslash\)'}) ) && *(S5Addr
      +4) == 0x12 )
240                   \{
241                      S5Addr += 5;
242                      S5Addr += ((*S5Addr &0xC0)>>6) +2;   \textcolor{comment}{// calculate PkgLength size}
243 
244                      \textcolor{keywordflow}{if} (*S5Addr == 0x0A)
245                         S5Addr++;   \textcolor{comment}{// skip byteprefix}
246                      \hyperlink{acpi_8c_a377b954bbafc1caae62c790a84625e2c}{SLP\_TYPa} = *(S5Addr)<<10;
247                      S5Addr++;
248 
249                      \textcolor{keywordflow}{if} (*S5Addr == 0x0A)
250                         S5Addr++;   \textcolor{comment}{// skip byteprefix}
251                      \hyperlink{acpi_8c_a73d59c76364473fa8dfb23f609728568}{SLP\_TYPb} = *(S5Addr)<<10;
252 
253                      \hyperlink{acpi_8c_a33b8ab25b3f4c51863b154877144f3df}{SMI\_CMD} = facp->\hyperlink{structFACP_a1ec5f1557834030b62601ecbf75eae9c}{SMI\_CMD};
254 
255                      \hyperlink{acpi_8c_a34153f28c481147d24e470eb95db14ea}{ACPI\_ENABLE} = facp->\hyperlink{structFACP_a0ce6f514986cb7577fd80249528d4bf0}{ACPI\_ENABLE};
256                      \hyperlink{acpi_8c_a03d9362da0e66c33d75b9a3249255158}{ACPI\_DISABLE} = facp->\hyperlink{structFACP_ac7a25cb3b147fd2824eee9c6fe06f2e3}{ACPI\_DISABLE};
257 
258                      \hyperlink{acpi_8c_a1a546c2755013ff60aaafcdab0befae9}{PM1a\_CNT} = facp->\hyperlink{structFACP_a60341d35abc5ca9a85e97ec88f2afa0c}{PM1a\_CNT\_BLK};
259                      \hyperlink{acpi_8c_a58d7d7d0ab171e520fae96b370db740b}{PM1b\_CNT} = facp->\hyperlink{structFACP_a3f6c4a12d7aaa5b666230cb71d694e5b}{PM1b\_CNT\_BLK};
260 
261                      \hyperlink{acpi_8c_a1a17515f9c86fc1266c1f04b7c5eb10e}{PM1\_CNT\_LEN} = facp->\hyperlink{structFACP_aef6c96d35d4c773fb1e06e9baacd2a5f}{PM1\_CNT\_LEN};
262 
263                      \hyperlink{acpi_8c_a865638a43175e3591eb2c085ffd21317}{SLP\_EN} = 1<<13;
264                      \hyperlink{acpi_8c_a15c1e5908be89bca113b617faa86b6f3}{SCI\_EN} = 1;
265 
266                      \textcolor{keywordflow}{return} 0;
267                   \} \textcolor{keywordflow}{else} \{
268                      \hyperlink{console_8c_a7e3f5006dd96b9d8c61242ddc5351832}{console\_writestring}(\textcolor{stringliteral}{"\(\backslash\)\(\backslash\)\_S5 parse error.\(\backslash\)n"});
269                   \}
270                \} \textcolor{keywordflow}{else} \{
271                   \hyperlink{console_8c_a7e3f5006dd96b9d8c61242ddc5351832}{console\_writestring}(\textcolor{stringliteral}{"\(\backslash\)\(\backslash\)\_S5 not present.\(\backslash\)n"});
272                \}
273             \} \textcolor{keywordflow}{else} \{
274                \hyperlink{console_8c_a7e3f5006dd96b9d8c61242ddc5351832}{console\_writestring}(\textcolor{stringliteral}{"DSDT invalid.\(\backslash\)n"});
275             \}
276          \}
277          ptr++;
278       \}
279       \hyperlink{console_8c_a7e3f5006dd96b9d8c61242ddc5351832}{console\_writestring}(\textcolor{stringliteral}{"no valid FACP present.\(\backslash\)n"});
280    \} \textcolor{keywordflow}{else} \{
281       \hyperlink{console_8c_a7e3f5006dd96b9d8c61242ddc5351832}{console\_writestring}(\textcolor{stringliteral}{"no acpi.\(\backslash\)n"});
282    \}
283 
284    \textcolor{keywordflow}{return} -1;
285 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{acpi_8c_a7fe73cf42200ac2245d5dd48fe2268db_cgraph}
\end{center}
\end{figure}




\subsection{Variable Documentation}
\index{acpi.\+c@{acpi.\+c}!A\+C\+P\+I\+\_\+\+D\+I\+S\+A\+B\+LE@{A\+C\+P\+I\+\_\+\+D\+I\+S\+A\+B\+LE}}
\index{A\+C\+P\+I\+\_\+\+D\+I\+S\+A\+B\+LE@{A\+C\+P\+I\+\_\+\+D\+I\+S\+A\+B\+LE}!acpi.\+c@{acpi.\+c}}
\subsubsection[{\texorpdfstring{A\+C\+P\+I\+\_\+\+D\+I\+S\+A\+B\+LE}{ACPI_DISABLE}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf byte} A\+C\+P\+I\+\_\+\+D\+I\+S\+A\+B\+LE}\hypertarget{acpi_8c_a03d9362da0e66c33d75b9a3249255158}{}\label{acpi_8c_a03d9362da0e66c33d75b9a3249255158}


Definition at line 14 of file acpi.\+c.

\index{acpi.\+c@{acpi.\+c}!A\+C\+P\+I\+\_\+\+E\+N\+A\+B\+LE@{A\+C\+P\+I\+\_\+\+E\+N\+A\+B\+LE}}
\index{A\+C\+P\+I\+\_\+\+E\+N\+A\+B\+LE@{A\+C\+P\+I\+\_\+\+E\+N\+A\+B\+LE}!acpi.\+c@{acpi.\+c}}
\subsubsection[{\texorpdfstring{A\+C\+P\+I\+\_\+\+E\+N\+A\+B\+LE}{ACPI_ENABLE}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf byte} A\+C\+P\+I\+\_\+\+E\+N\+A\+B\+LE}\hypertarget{acpi_8c_a34153f28c481147d24e470eb95db14ea}{}\label{acpi_8c_a34153f28c481147d24e470eb95db14ea}


Definition at line 13 of file acpi.\+c.

\index{acpi.\+c@{acpi.\+c}!P\+M1\+\_\+\+C\+N\+T\+\_\+\+L\+EN@{P\+M1\+\_\+\+C\+N\+T\+\_\+\+L\+EN}}
\index{P\+M1\+\_\+\+C\+N\+T\+\_\+\+L\+EN@{P\+M1\+\_\+\+C\+N\+T\+\_\+\+L\+EN}!acpi.\+c@{acpi.\+c}}
\subsubsection[{\texorpdfstring{P\+M1\+\_\+\+C\+N\+T\+\_\+\+L\+EN}{PM1_CNT_LEN}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf byte} P\+M1\+\_\+\+C\+N\+T\+\_\+\+L\+EN}\hypertarget{acpi_8c_a1a17515f9c86fc1266c1f04b7c5eb10e}{}\label{acpi_8c_a1a17515f9c86fc1266c1f04b7c5eb10e}


Definition at line 21 of file acpi.\+c.

\index{acpi.\+c@{acpi.\+c}!P\+M1a\+\_\+\+C\+NT@{P\+M1a\+\_\+\+C\+NT}}
\index{P\+M1a\+\_\+\+C\+NT@{P\+M1a\+\_\+\+C\+NT}!acpi.\+c@{acpi.\+c}}
\subsubsection[{\texorpdfstring{P\+M1a\+\_\+\+C\+NT}{PM1a_CNT}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf dword}$\ast$ P\+M1a\+\_\+\+C\+NT}\hypertarget{acpi_8c_a1a546c2755013ff60aaafcdab0befae9}{}\label{acpi_8c_a1a546c2755013ff60aaafcdab0befae9}


Definition at line 15 of file acpi.\+c.

\index{acpi.\+c@{acpi.\+c}!P\+M1b\+\_\+\+C\+NT@{P\+M1b\+\_\+\+C\+NT}}
\index{P\+M1b\+\_\+\+C\+NT@{P\+M1b\+\_\+\+C\+NT}!acpi.\+c@{acpi.\+c}}
\subsubsection[{\texorpdfstring{P\+M1b\+\_\+\+C\+NT}{PM1b_CNT}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf dword}$\ast$ P\+M1b\+\_\+\+C\+NT}\hypertarget{acpi_8c_a58d7d7d0ab171e520fae96b370db740b}{}\label{acpi_8c_a58d7d7d0ab171e520fae96b370db740b}


Definition at line 16 of file acpi.\+c.

\index{acpi.\+c@{acpi.\+c}!S\+C\+I\+\_\+\+EN@{S\+C\+I\+\_\+\+EN}}
\index{S\+C\+I\+\_\+\+EN@{S\+C\+I\+\_\+\+EN}!acpi.\+c@{acpi.\+c}}
\subsubsection[{\texorpdfstring{S\+C\+I\+\_\+\+EN}{SCI_EN}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf word} S\+C\+I\+\_\+\+EN}\hypertarget{acpi_8c_a15c1e5908be89bca113b617faa86b6f3}{}\label{acpi_8c_a15c1e5908be89bca113b617faa86b6f3}


Definition at line 20 of file acpi.\+c.

\index{acpi.\+c@{acpi.\+c}!S\+L\+P\+\_\+\+EN@{S\+L\+P\+\_\+\+EN}}
\index{S\+L\+P\+\_\+\+EN@{S\+L\+P\+\_\+\+EN}!acpi.\+c@{acpi.\+c}}
\subsubsection[{\texorpdfstring{S\+L\+P\+\_\+\+EN}{SLP_EN}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf word} S\+L\+P\+\_\+\+EN}\hypertarget{acpi_8c_a865638a43175e3591eb2c085ffd21317}{}\label{acpi_8c_a865638a43175e3591eb2c085ffd21317}


Definition at line 19 of file acpi.\+c.

\index{acpi.\+c@{acpi.\+c}!S\+L\+P\+\_\+\+T\+Y\+Pa@{S\+L\+P\+\_\+\+T\+Y\+Pa}}
\index{S\+L\+P\+\_\+\+T\+Y\+Pa@{S\+L\+P\+\_\+\+T\+Y\+Pa}!acpi.\+c@{acpi.\+c}}
\subsubsection[{\texorpdfstring{S\+L\+P\+\_\+\+T\+Y\+Pa}{SLP_TYPa}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf word} S\+L\+P\+\_\+\+T\+Y\+Pa}\hypertarget{acpi_8c_a377b954bbafc1caae62c790a84625e2c}{}\label{acpi_8c_a377b954bbafc1caae62c790a84625e2c}


Definition at line 17 of file acpi.\+c.

\index{acpi.\+c@{acpi.\+c}!S\+L\+P\+\_\+\+T\+Y\+Pb@{S\+L\+P\+\_\+\+T\+Y\+Pb}}
\index{S\+L\+P\+\_\+\+T\+Y\+Pb@{S\+L\+P\+\_\+\+T\+Y\+Pb}!acpi.\+c@{acpi.\+c}}
\subsubsection[{\texorpdfstring{S\+L\+P\+\_\+\+T\+Y\+Pb}{SLP_TYPb}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf word} S\+L\+P\+\_\+\+T\+Y\+Pb}\hypertarget{acpi_8c_a73d59c76364473fa8dfb23f609728568}{}\label{acpi_8c_a73d59c76364473fa8dfb23f609728568}


Definition at line 18 of file acpi.\+c.

\index{acpi.\+c@{acpi.\+c}!S\+M\+I\+\_\+\+C\+MD@{S\+M\+I\+\_\+\+C\+MD}}
\index{S\+M\+I\+\_\+\+C\+MD@{S\+M\+I\+\_\+\+C\+MD}!acpi.\+c@{acpi.\+c}}
\subsubsection[{\texorpdfstring{S\+M\+I\+\_\+\+C\+MD}{SMI_CMD}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf dword}$\ast$ S\+M\+I\+\_\+\+C\+MD}\hypertarget{acpi_8c_a33b8ab25b3f4c51863b154877144f3df}{}\label{acpi_8c_a33b8ab25b3f4c51863b154877144f3df}


Definition at line 12 of file acpi.\+c.

